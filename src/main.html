<div id="cadastrar">
    <h1>Cadastrar</h1>
    <label for="nome">
        Nome: <br>
        <input type="text" name="name" id="nome">
    </label><br>
    <label for="email">
        Email:<br>
        <input type="email" name="email" id="email">
    </label><br>
    <label for="user">
        User:<br>
        <input type="text" name="user" id="user">
    </label><br>
    <label for="password">
        Password:<br>
        <input type="password" name="password" id="password">
    </label><br>
    <label for="confirmPassword">
        Confirm Password:<br>
        <input type="password" name="confirmPassword" id="confirmPassword">
    </label><br>
    <input type="submit" value="Enviar" onclick="cadastrarDados()"><br><br>
</div>
<div id="entrar">
    <h1>Login</h1>
    <label for="loginUser">
        User:<br>
        <input type="text" name="user" id="loginUser">
    </label><br>
    <label for="loginPassword">
        Password:<br>
        <input type="password" name="password" id="loginPassword">
    </label><br>
    <input type="submit" value="Enviar" onclick="entrar()"><br><br>
</div>

<button onclick="vizualizarMinhaBiblioteca()">Vizualizar Minha Biblioteca</button>
<div id="busca-minha-biblioteca" style="display: none;"></div>

<script>
    function cadastrarDados(){
        let nome = document.querySelector("#nome").value;
        let email = document.querySelector("#email").value;
        let user = document.querySelector("#user").value;
        let senha = document.querySelector("#password").value;
        let confirmPassword = document.querySelector("#confirmPassword").value;

        fetch(
            "http://localhost/api.biblioteca/register", 
            {
                method: 'POST',
                body: JSON.stringify(
                    {
                        "name": nome,
                        "email": email,
                        "user": user,
                        "password": senha,
                        "passwordConfirm": confirmPassword
                    }
                ), 
                headers: {
                    "Content-Type": "application/json"
                }
            }
        ).then(
            function(response)
            {
                return response.json()
            }
        ).then(
            function(data)
            {
                console.log(data)
            }
        ).catch(
            function (response) 
            {
                console.log(response.json);
            }
        );
    }
    function entrar(){
        let user = document.querySelector("#loginUser").value;
        let senha = document.querySelector("#loginPassword").value;

        fetch(
            "http://localhost/api.biblioteca/auth", 
            {
                method: 'POST',
                body: JSON.stringify(
                    {
                        "user": user,
                        "password": senha
                    }
                ), 
                headers: {
                    "Content-Type": "application/json"
                }
            }
        ).then(
            function(response) 
            {
                return response.json();
            }
        ).then(
            function(data)  
            {
                localStorage.setItem("token", data.token);
                console.log(localStorage.getItem("token"));
            }
        ).catch(
            function (response) {
                console.log(response);
            }
        );
    }
    function vizualizarMinhaBiblioteca(){
        fetch(
            "http://localhost/api.biblioteca/minhaBiblioteca", 
            {
                method: 'GET',
                headers: 
                {
                    'Authorization': localStorage.getItem("token")
                }
            }
        ).then(
            function(response) 
            {
                return response.json();
            }
        ).then(
            function(data) 
            {
                document.querySelector("#busca-minha-biblioteca").style.display = "block";
                for(i in data)
                {
                    document.querySelector("#busca-minha-biblioteca").innerHTML += `
                        <p class="title">${data[i].titulo}</p>
                    `;
                    console.log(data[i].titulo);
                }
            }
        ).catch(
            function (response) 
            {
                console.log(response);
            }
        );
    }
    
</script>